<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>eb.types &mdash; EnMAP-Box 3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="EnMAP-Box 3.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for eb.types</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">axes</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;janzandr&#39;</span>

<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">hub</span>
<span class="kn">from</span> <span class="nn">eb.env</span> <span class="kn">import</span> <span class="n">PrintProgress</span><span class="p">,</span> <span class="n">SilentProgress</span>
<span class="kn">from</span> <span class="nn">eb.applier</span> <span class="kn">import</span> <span class="n">ApplierHelper</span><span class="p">,</span> <span class="n">ApplierControls</span>
<span class="kn">from</span> <span class="nn">hub.gdal.api</span> <span class="kn">import</span> <span class="n">GDALMeta</span>
<span class="kn">import</span> <span class="nn">hub.gdal.util</span><span class="o">,</span> <span class="nn">hub.gdal.api</span><span class="o">,</span> <span class="nn">hub.envi</span>
<span class="kn">import</span> <span class="nn">hub.file</span>
<span class="kn">import</span> <span class="nn">rios.applier</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="c1">#import numpy.ma</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span>
<span class="kn">import</span> <span class="nn">sklearn.pipeline</span>
<span class="kn">import</span> <span class="nn">eb.report</span>
<span class="kn">from</span> <span class="nn">eb.report</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">gdal</span><span class="o">,</span> <span class="nn">ogr</span>

<span class="c1"># set default progress object</span>
<span class="n">progress</span> <span class="o">=</span> <span class="n">SilentProgress</span>
<span class="c1">#progress = PrintProgress  # useful for debugging</span>


<div class="viewcode-block" id="unpickle"><a class="viewcode-back" href="../../eb.html#eb.types.unpickle">[docs]</a><span class="k">def</span> <span class="nf">unpickle</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">restorePickle</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;unpickle model from file: &#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="Type"><a class="viewcode-back" href="../../eb.html#eb.types.Type">[docs]</a><span class="k">class</span> <span class="nc">Type</span><span class="p">():</span>

<div class="viewcode-block" id="Type.aside"><a class="viewcode-back" href="../../eb.html#eb.types.Type.aside">[docs]</a>    <span class="k">def</span> <span class="nf">aside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Type.pickle"><a class="viewcode-back" href="../../eb.html#eb.types.Type.pickle">[docs]</a>    <span class="k">def</span> <span class="nf">pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;pickle model to file: &#39;</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">savePickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Type.report"><a class="viewcode-back" href="../../eb.html#eb.types.Type.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Type.info"><a class="viewcode-back" href="../../eb.html#eb.types.Type.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">()</span><span class="o">.</span><span class="n">saveHTML</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="Meta"><a class="viewcode-back" href="../../eb.html#eb.types.Meta">[docs]</a><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">GDALMeta</span><span class="p">):</span>

<div class="viewcode-block" id="Meta.report"><a class="viewcode-back" href="../../eb.html#eb.types.Meta.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;GDAL Datasource&#39;</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">text</span> <span class="o">+=</span>   <span class="s1">&#39;Projection  = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Projection</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RasterSize  = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RasterXSize</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RasterYSize</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RasterCount = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">PixelSize   = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelXSize</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelYSize</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMetadataDict</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;ENVI Domain&#39;</span><span class="p">))</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;GDAL Domains&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ENVI&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">report</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Bands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;bands&#39;</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">BandNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bandNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;band_names&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bandNames</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">bandNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Band &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RasterCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">bandNames</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ClassNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;class_names&#39;</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ClassLookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;class_lookup&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Classes</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../eb.html#eb.types.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">Type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An GDAL conform image with no further assumptions about the image meta data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Image.fromENVISpectralLibrary"><a class="viewcode-back" href="../../eb.html#eb.types.Image.fromENVISpectralLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">fromENVISpectralLibrary</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

        <span class="n">filenameHdr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.hdr&#39;</span>
        <span class="n">tempfilename</span> <span class="o">=</span> <span class="n">eb</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">()</span>
        <span class="n">temptilenameHdr</span> <span class="o">=</span> <span class="n">tempfilename</span><span class="o">+</span><span class="s1">&#39;.hdr&#39;</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tempfilename</span><span class="p">)</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">envi</span><span class="o">.</span><span class="n">readHeader</span><span class="p">(</span><span class="n">filenameHdr</span><span class="p">)</span>
        <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;file type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ENVI Standard&#39;</span>
        <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;interleave&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bip&#39;</span>
        <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;bands&#39;</span><span class="p">],</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">],</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;bands&#39;</span><span class="p">]</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">envi</span><span class="o">.</span><span class="n">writeHeader</span><span class="p">(</span><span class="n">temptilenameHdr</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Image</span><span class="p">(</span><span class="n">tempfilename</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">),</span> <span class="s1">&#39;Incorrect filename!&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;Incorrect filename!&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;) = &#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>


    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="Image.report"><a class="viewcode-back" href="../../eb.html#eb.types.Image.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">reportMeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;Image Information&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;Filename: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">appendReport</span><span class="p">(</span><span class="n">reportMeta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">report</span></div>


<div class="viewcode-block" id="Image.saveAs"><a class="viewcode-back" href="../../eb.html#eb.types.Image.saveAs">[docs]</a>    <span class="k">def</span> <span class="nf">saveAs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s1">&#39;-of ENVI&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">()</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">gdal</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">gdal_translate</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">infile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">writeMeta</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="Image.statistics"><a class="viewcode-back" href="../../eb.html#eb.types.Image.statistics">[docs]</a>    <span class="k">def</span> <span class="nf">statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;with histo&#39;</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">ImageStatistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>  <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="Image.stack"><a class="viewcode-back" href="../../eb.html#eb.types.Image.stack">[docs]</a>    <span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="p">[],</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>


        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="s1">&#39;stack&#39;</span><span class="p">,</span> <span class="s1">&#39;.vrt&#39;</span><span class="p">)</span>
        <span class="n">infiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">filename</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">images</span><span class="p">]</span>
        <span class="n">options</span> <span class="o">=</span>  <span class="s1">&#39; -resolution user -tr &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">pixelXSize</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">pixelYSize</span><span class="p">))</span>
        <span class="n">options</span> <span class="o">+=</span> <span class="s1">&#39; -vrtnodata 0&#39;</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">gdal</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">infiles</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">SpatialReference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">None</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">BoundingBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">upperLeft</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
        <span class="n">lowerRight</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">upperLeft</span><span class="p">,</span> <span class="n">lowerRight</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">PixelSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">pixelXSize</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">pixelYSize</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">PixelGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">PixelGrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">PixelSize</span><span class="p">)</span></div>


<div class="viewcode-block" id="PixelGrid"><a class="viewcode-back" href="../../eb.html#eb.types.PixelGrid">[docs]</a><span class="k">class</span> <span class="nc">PixelGrid</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spatialReference</span><span class="p">,</span> <span class="n">pixelCorner</span><span class="p">,</span> <span class="n">pixelSize</span><span class="p">):</span>

        <span class="c1">#assert isinstance(spatialReference, ogr)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatialReference</span> <span class="o">=</span> <span class="n">spatialReference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelCorner</span> <span class="o">=</span> <span class="n">pixelCorner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span> <span class="o">=</span> <span class="n">pixelSize</span>


<div class="viewcode-block" id="PixelGrid.project"><a class="viewcode-back" href="../../eb.html#eb.types.PixelGrid.project">[docs]</a>    <span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">boundingBox</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.vrt&#39;</span><span class="p">)</span>

        <span class="c1"># calculate exact output bounding box</span>
        <span class="c1"># - get image bounding box in target SRS</span>
        <span class="k">if</span> <span class="n">boundingBox</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">boundingBox</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">hub</span><span class="o">.</span><span class="n">gdal</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">gdalwarp</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.vrt&#39;</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s1">&#39;-of VRT&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span><span class="o">.</span><span class="n">BoundingBox</span>

        <span class="c1"># - snap bounding box to target pixel grid</span>
        <span class="n">xoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">boundingBox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelCorner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">boundingBox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelCorner</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">boundingBox</span> <span class="o">=</span> <span class="p">((</span><span class="n">boundingBox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xoff</span><span class="p">,</span> <span class="n">boundingBox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yoff</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">boundingBox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xoff</span><span class="p">,</span> <span class="n">boundingBox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yoff</span><span class="p">))</span>

        <span class="n">options</span>  <span class="o">=</span> <span class="s1">&#39; -of VRT&#39;</span>
        <span class="n">options</span> <span class="o">+=</span> <span class="s1">&#39; -tr &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">options</span> <span class="o">+=</span> <span class="s1">&#39; -r average&#39;</span>
        <span class="n">options</span> <span class="o">+=</span> <span class="s1">&#39; -te&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">boundingBox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                          <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">boundingBox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">boundingBox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> \
                          <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">boundingBox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                          <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">boundingBox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">boundingBox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">hub</span><span class="o">.</span><span class="n">gdal</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">gdalwarp</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>


        <span class="c1"># set up ENVI Metadata</span>
        <span class="n">metaTmp</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setMetadataItem</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="n">metaTmp</span><span class="o">.</span><span class="n">RasterXSize</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setMetadataItem</span><span class="p">(</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">metaTmp</span><span class="o">.</span><span class="n">RasterXSize</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">writeMeta</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="ImageStatistics"><a class="viewcode-back" href="../../eb.html#eb.types.ImageStatistics">[docs]</a><span class="k">class</span> <span class="nc">ImageStatistics</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="n">histoMin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">histoMax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">histoBins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="s1">&#39;with histo&#39;</span><span class="p">,</span> <span class="s1">&#39;only histo&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">Mask</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;simple&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">firstRun</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">histoMin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">histoMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;with histo&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">histoMin</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">histoMax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">firstRun</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">histoMin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">histoMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span>
            <span class="k">if</span> <span class="n">histoMin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">histoMin</span> <span class="o">=</span> <span class="n">histoMin</span>
            <span class="k">if</span> <span class="n">histoMax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">histoMax</span> <span class="o">=</span> <span class="n">histoMax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">histoBins</span> <span class="o">=</span> <span class="n">histoBins</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">firstRun</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;only histo&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">histoMin</span> <span class="o">=</span> <span class="n">histoMin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">histoMax</span> <span class="o">=</span> <span class="n">histoMax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">histoBins</span> <span class="o">=</span> <span class="n">histoBins</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doit</span><span class="p">(</span><span class="n">firstRun</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<div class="viewcode-block" id="ImageStatistics.doit"><a class="viewcode-back" href="../../eb.html#eb.types.ImageStatistics.doit">[docs]</a>    <span class="k">def</span> <span class="nf">doit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firstRun</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;calculate statistics&#39;</span><span class="p">)</span>

        <span class="n">infiles</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">FilenameAssociations</span><span class="p">()</span>
        <span class="n">outfiles</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">FilenameAssociations</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">OtherInputs</span><span class="p">()</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="n">ApplierControls</span><span class="p">()</span>

        <span class="n">infiles</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">args</span><span class="o">.</span><span class="n">useMask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">useMask</span><span class="p">:</span> <span class="n">infiles</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">args</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
        <span class="n">args</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">args</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span>
        <span class="n">args</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setDebugInfo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">controls</span><span class="p">))</span>

        <span class="c1"># set up the function to be applied</span>
        <span class="k">def</span> <span class="nf">ufunc</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>

            <span class="n">args</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setPercentage</span><span class="p">(</span><span class="n">ApplierHelper</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>

            <span class="n">ApplierHelper</span><span class="o">.</span><span class="n">reshape2d</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

            <span class="c1"># create mask</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">+=</span> <span class="n">ApplierHelper</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getNoDataValue</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">useMask</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">+=</span> <span class="n">ApplierHelper</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getNoDataValue</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

            <span class="c1"># extract values</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">ApplierHelper</span><span class="o">.</span><span class="n">maskedArray</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

            <span class="c1"># calculate statistics</span>
            <span class="k">if</span> <span class="n">ApplierHelper</span><span class="o">.</span><span class="n">firstBlock</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nvalid</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=+</span><span class="n">numpy</span><span class="o">.</span><span class="n">Inf</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=-</span><span class="n">numpy</span><span class="o">.</span><span class="n">Inf</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">firstRun</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sumSquaredDeviation</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binEdges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">histoBins</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">binEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">histoBins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">histoMin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">histoMax</span><span class="p">[</span><span class="n">i</span><span class="p">]])[</span><span class="mi">1</span><span class="p">])</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">nvalid</span> <span class="o">+=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">count_masked</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">firstRun</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s1">&#39;only histo&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sumSquaredDeviation</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">image</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">):</span>
                    <span class="n">counts</span><span class="p">,</span> <span class="n">binEdges</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">histoBins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">histoMin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">histoMax</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">counts</span>

        <span class="c1"># Apply the function to the inputs, creating the outputs.</span>
        <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ufunc</span><span class="p">,</span> <span class="n">infiles</span><span class="p">,</span> <span class="n">outfiles</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nvalid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">firstRun</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stddev</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sumSquaredDeviation</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nvalid</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImageStatistics.report"><a class="viewcode-back" href="../../eb.html#eb.types.ImageStatistics.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;Image Statistics&#39;</span><span class="p">)</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;min: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;max: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;mean: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;with histo&#39;</span><span class="p">:</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;stddev: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stddev</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s1">&#39;simple&#39;</span><span class="p">:</span>

            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Band Histograms&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">binEdges</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binEdges</span><span class="p">)):</span>
                <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Band &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;bin edges: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">binEdges</span><span class="p">)</span>
                                           <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">counts:    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counts</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">report</span></div></div>


<div class="viewcode-block" id="SpectralImage"><a class="viewcode-back" href="../../eb.html#eb.types.SpectralImage">[docs]</a><span class="k">class</span> <span class="nc">SpectralImage</span><span class="p">(</span><span class="n">Image</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="SpectralLibrary"><a class="viewcode-back" href="../../eb.html#eb.types.SpectralLibrary">[docs]</a><span class="k">class</span> <span class="nc">SpectralLibrary</span><span class="p">(</span><span class="n">SpectralImage</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Mask"><a class="viewcode-back" href="../../eb.html#eb.types.Mask">[docs]</a><span class="k">class</span> <span class="nc">Mask</span><span class="p">(</span><span class="n">Image</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">Image</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">RasterCount</span> <span class="o">==</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="Classification"><a class="viewcode-back" href="../../eb.html#eb.types.Classification">[docs]</a><span class="k">class</span> <span class="nc">Classification</span><span class="p">(</span><span class="n">Mask</span><span class="p">):</span>


    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">Mask</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">envi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataDict</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">envi</span><span class="p">[</span><span class="s1">&#39;file_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;envi classification&#39;</span>
        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">envi</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">envi</span><span class="p">[</span><span class="s1">&#39;class_names&#39;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">envi</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">3</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">envi</span><span class="p">[</span><span class="s1">&#39;class_lookup&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="Classification.assessClassificationPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.Classification.assessClassificationPerformance">[docs]</a>    <span class="k">def</span> <span class="nf">assessClassificationPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classification</span><span class="p">,</span> <span class="n">stratification</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classification</span><span class="p">,</span> <span class="n">Classification</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">ClassificationSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classification</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stratification</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ClassificationPerformance</span><span class="o">.</span><span class="n">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stratification</span><span class="p">,</span> <span class="n">Classification</span><span class="p">)</span>
            <span class="n">sampleStratification</span> <span class="o">=</span> <span class="n">ClassificationSample</span><span class="p">(</span><span class="n">stratification</span><span class="p">,</span> <span class="n">classification</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ClassificationPerformanceAdjusted</span><span class="o">.</span><span class="n">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">sampleStratification</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="Classification.assessClusteringPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.Classification.assessClusteringPerformance">[docs]</a>    <span class="k">def</span> <span class="nf">assessClusteringPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classification</span><span class="p">):</span>


        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classification</span><span class="p">,</span> <span class="n">Classification</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">ClassificationSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classification</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ClusteringPerformance</span><span class="o">.</span><span class="n">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span></div>


<div class="viewcode-block" id="Classification.statistics"><a class="viewcode-back" href="../../eb.html#eb.types.Classification.statistics">[docs]</a>    <span class="k">def</span> <span class="nf">statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">Mask</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ClassificationStatistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ClassificationStatistics"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationStatistics">[docs]</a><span class="k">class</span> <span class="nc">ClassificationStatistics</span><span class="p">(</span><span class="n">ImageStatistics</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classification</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classification</span><span class="p">,</span> <span class="n">Classification</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">Mask</span><span class="p">)</span>

        <span class="n">ImageStatistics</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classification</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;only histo&#39;</span><span class="p">,</span> <span class="n">histoMin</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">histoMax</span><span class="o">=</span><span class="p">[</span><span class="n">classification</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Classes</span><span class="p">],</span> <span class="n">histoBins</span><span class="o">=</span><span class="n">classification</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Classes</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>


<div class="viewcode-block" id="ClassificationStatistics.report"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationStatistics.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;Classification Statistics&#39;</span><span class="p">)</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;class names: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ClassNames</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;class labels: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Classes</span><span class="p">))))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;class counts: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;class colors: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ClassLookup</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>


        <span class="k">return</span> <span class="n">report</span></div></div>


<div class="viewcode-block" id="Regression"><a class="viewcode-back" href="../../eb.html#eb.types.Regression">[docs]</a><span class="k">class</span> <span class="nc">Regression</span><span class="p">(</span><span class="n">Mask</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">Mask</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">envi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataDict</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">envi</span><span class="p">[</span><span class="s1">&#39;data_ignore_value&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>


<div class="viewcode-block" id="Regression.assessRegressionPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.Regression.assessRegressionPerformance">[docs]</a>    <span class="k">def</span> <span class="nf">assessRegressionPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regression</span><span class="p">):</span>

        <span class="n">sample</span> <span class="o">=</span> <span class="n">RegressionSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regression</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RegressionPerformance</span><span class="o">.</span><span class="n">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Probability"><a class="viewcode-back" href="../../eb.html#eb.types.Probability">[docs]</a><span class="k">class</span> <span class="nc">Probability</span><span class="p">(</span><span class="n">Image</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">envi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataDict</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">envi</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">envi</span><span class="p">[</span><span class="s1">&#39;class_names&#39;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">envi</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">3</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">envi</span><span class="p">[</span><span class="s1">&#39;class_lookup&#39;</span><span class="p">])</span>
        <span class="n">Image</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="Probability.assessProbabilityPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.Probability.assessProbabilityPerformance">[docs]</a>    <span class="k">def</span> <span class="nf">assessProbabilityPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classification</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classification</span><span class="p">,</span> <span class="n">Classification</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">ClassificationSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classification</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ProbabilityPerformance</span><span class="o">.</span><span class="n">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ProbabilityPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.ProbabilityPerformance">[docs]</a><span class="k">class</span> <span class="nc">ProbabilityPerformance</span><span class="p">(</span><span class="n">Type</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ProbabilityPerformance.fromSample"><a class="viewcode-back" href="../../eb.html#eb.types.ProbabilityPerformance.fromSample">[docs]</a>    <span class="k">def</span> <span class="nf">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">ImageSample</span><span class="p">),</span> <span class="s1">&#39;Image sample is requiered!&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">Probability</span><span class="p">),</span> <span class="s1">&#39;Prediction is not a probability image!&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ProbabilityPerformance</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Classes</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">yScore</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">yTruth</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">labelData</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">assessPerformance</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yScore</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>


<div class="viewcode-block" id="ProbabilityPerformance.update"><a class="viewcode-back" href="../../eb.html#eb.types.ProbabilityPerformance.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yScore</span><span class="p">,</span> <span class="n">yTruth</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yScore</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yScore</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">yScore</span><span class="p">,</span> <span class="n">yScore</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">yTruth</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProbabilityPerformance.assessPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.ProbabilityPerformance.assessPerformance">[docs]</a>    <span class="k">def</span> <span class="nf">assessPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">roc_fpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roc_tpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roc_thresholds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roc_auc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prc_precision</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prc_recall</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prc_thresholds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yScore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roc_fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">roc_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">roc_thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yScore</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">pos_label</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roc_fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">roc_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">prc_precision</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prc_recall</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prc_thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">precision_recall_curve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yScore</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">pos_label</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProbabilityPerformance.report"><a class="viewcode-back" href="../../eb.html#eb.types.ProbabilityPerformance.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;Probability Performance&#39;</span><span class="p">)</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Receiver Operating Characteristic (ROC) Curve&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">className</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ClassNames</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="n">className</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;fpr = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roc_fpr</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;tpr = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roc_tpr</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;thresholds = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roc_thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;auc = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Precision-Recall Curve&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">className</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ClassNames</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="n">className</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;precision = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prc_precision</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;recall = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prc_recall</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;thresholds = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prc_thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

        <span class="k">return</span> <span class="n">report</span></div></div>


<div class="viewcode-block" id="Estimator"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator">[docs]</a><span class="k">class</span> <span class="nc">Estimator</span><span class="p">(</span><span class="n">Type</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sklEstimator</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sklEstimator</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span> <span class="o">=</span> <span class="n">sklEstimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="p">,</span> <span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;fit model&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">imageData</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">sample</span><span class="o">.</span><span class="n">labelData</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">predictfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">probafile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">transformfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inversetransformfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;apply model&#39;</span><span class="p">)</span>

        <span class="n">infiles</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">FilenameAssociations</span><span class="p">()</span>
        <span class="n">outfiles</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">FilenameAssociations</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">OtherInputs</span><span class="p">()</span>

        <span class="n">infiles</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="n">predictfile</span><span class="p">:</span> <span class="n">outfiles</span><span class="o">.</span><span class="n">predict</span> <span class="o">=</span> <span class="n">predictfile</span>
        <span class="k">if</span> <span class="n">probafile</span><span class="p">:</span> <span class="n">outfiles</span><span class="o">.</span><span class="n">proba</span> <span class="o">=</span> <span class="n">probafile</span>
        <span class="k">if</span> <span class="n">transformfile</span><span class="p">:</span> <span class="n">outfiles</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transformfile</span>
        <span class="k">if</span> <span class="n">inversetransformfile</span><span class="p">:</span> <span class="n">outfiles</span><span class="o">.</span><span class="n">inversetransform</span> <span class="o">=</span> <span class="n">inversetransformfile</span>

        <span class="n">args</span><span class="o">.</span><span class="n">useMask</span> <span class="o">=</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">useMask</span><span class="p">:</span> <span class="n">infiles</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">args</span><span class="o">.</span><span class="n">xMeta</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">meta</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">useMask</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">mMeta</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">meta</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">estimator_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">_estimator_type</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">estimator_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">_final_estimator</span><span class="o">.</span><span class="n">__class__</span>

        <span class="n">controls</span> <span class="o">=</span> <span class="n">ApplierControls</span><span class="p">()</span>
        <span class="n">controls</span><span class="o">.</span><span class="n">setNumThreads</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">controls</span><span class="o">.</span><span class="n">windowxsize</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">controls</span><span class="o">.</span><span class="n">windowysize</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">setDebugInfo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">controls</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">controls</span><span class="o">.</span><span class="n">numThreads</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">SilentProgress</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span>
        <span class="n">args</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span>

        <span class="c1"># set up the function to be applied</span>
        <span class="k">def</span> <span class="nf">ufunc</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>

            <span class="n">args</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">setPercentage</span><span class="p">(</span><span class="n">ApplierHelper</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>


            <span class="c1"># reshape to 2d</span>
            <span class="n">shape3d</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">inputs</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">shape2d</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span>

            <span class="c1"># create mask</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c1"># - from x</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">xMeta</span><span class="o">.</span><span class="n">getNoDataValue</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">args</span><span class="o">.</span><span class="n">xMeta</span><span class="o">.</span><span class="n">getNoDataValue</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># - from m</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">useMask</span><span class="p">:</span> <span class="n">valid</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">m</span> <span class="o">!=</span> <span class="n">args</span><span class="o">.</span><span class="n">mMeta</span><span class="o">.</span><span class="n">getNoDataValue</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>

            <span class="n">allValid</span> <span class="o">=</span> <span class="n">valid</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="n">anyValid</span> <span class="o">=</span> <span class="n">valid</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">anyValid</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># predict valid samples</span>
            <span class="k">if</span> <span class="n">probafile</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">allValid</span><span class="p">:</span>
                    <span class="n">valid_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">valid_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="p">)</span>

            <span class="k">if</span> <span class="n">predictfile</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">allValid</span><span class="p">:</span>
                    <span class="n">valid_predict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">valid_predict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Clusterer</span><span class="p">):</span>
                    <span class="n">valid_predict</span> <span class="o">+=</span> <span class="mi">1</span>


            <span class="k">if</span> <span class="n">transformfile</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">allValid</span><span class="p">:</span>
                    <span class="n">valid_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">valid_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">inversetransformfile</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">allValid</span><span class="p">:</span>
                    <span class="n">valid_inversetransform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">valid_inversetransform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>


            <span class="c1"># prepare outputs</span>

            <span class="k">if</span> <span class="n">probafile</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">allValid</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">proba</span> <span class="o">=</span> <span class="n">valid_proba</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictProbabilityDType</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">proba</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">shape2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">valid_proba</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictProbabilityDType</span><span class="p">(),</span>
                                               <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictProbabilityNoDataValue</span><span class="p">())</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">proba</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid_proba</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalEstimator</span><span class="p">()</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">proba</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">proba</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>

            <span class="k">if</span> <span class="n">predictfile</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">allValid</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">predict</span> <span class="o">=</span> <span class="n">valid_predict</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictDType</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">predict</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">shape2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictDType</span><span class="p">(),</span>
                                                 <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictNoDataValue</span><span class="p">())</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">predict</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid_predict</span>

            <span class="k">if</span> <span class="n">transformfile</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">allValid</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">valid_transform</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformDType</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">shape2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">valid_transform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transformDType</span><span class="p">(),</span>
                                                   <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transformNoDataValue</span><span class="p">())</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">transform</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid_transform</span>

            <span class="k">if</span> <span class="n">inversetransformfile</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">allValid</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">inversetransform</span> <span class="o">=</span> <span class="n">valid_inversetransform</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformDType</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">inversetransform</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">shape2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">valid_inversetransform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transformDType</span><span class="p">(),</span>
                                                   <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transformNoDataValue</span><span class="p">())</span>
                    <span class="n">outputs</span><span class="o">.</span><span class="n">inversetransform</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid_inversetransform</span>


            <span class="c1"># reshape to 3d</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape3d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape3d</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="c1"># Apply the function to the inputs, creating the outputs.</span>
        <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ufunc</span><span class="p">,</span> <span class="n">infiles</span><span class="p">,</span> <span class="n">outfiles</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>

        <span class="c1"># Set Metadata for output images</span>

        <span class="k">if</span> <span class="n">predictfile</span><span class="p">:</span>

            <span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="n">outfiles</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictMeta</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">xMeta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">writeMeta</span><span class="p">(</span><span class="n">outfiles</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transformfile</span><span class="p">:</span>

            <span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="n">outfiles</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transformMeta</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">xMeta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">writeMeta</span><span class="p">(</span><span class="n">outfiles</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inversetransformfile</span><span class="p">:</span>

            <span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="n">outfiles</span><span class="o">.</span><span class="n">inversetransform</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transformInverseMeta</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">xMeta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">writeMeta</span><span class="p">(</span><span class="n">outfiles</span><span class="o">.</span><span class="n">inversetransform</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">probafile</span><span class="p">:</span>

            <span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span><span class="n">outfiles</span><span class="o">.</span><span class="n">proba</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictProbabilityMeta</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">xMeta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">writeMeta</span><span class="p">(</span><span class="n">outfiles</span><span class="o">.</span><span class="n">proba</span><span class="p">)</span>


<div class="viewcode-block" id="Estimator.predictDType"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.predictDType">[docs]</a>    <span class="k">def</span> <span class="nf">predictDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Methode must be overwritten&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Estimator.predictNoDataValue"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.predictNoDataValue">[docs]</a>    <span class="k">def</span> <span class="nf">predictNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Methode must be overwritten&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Estimator.predictMeta"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.predictMeta">[docs]</a>    <span class="k">def</span> <span class="nf">predictMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">imate</span><span class="p">,</span> <span class="n">mmeta</span><span class="p">):</span>

        <span class="n">meta</span><span class="o">.</span><span class="n">setNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictNoDataValue</span><span class="p">())</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setBandNames</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">()])</span></div>


<div class="viewcode-block" id="Estimator.transformNoDataValue"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.transformNoDataValue">[docs]</a>    <span class="k">def</span> <span class="nf">transformNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Methode must be overwritten&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Estimator.transformMeta"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.transformMeta">[docs]</a>    <span class="k">def</span> <span class="nf">transformMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">iimeta</span><span class="p">,</span> <span class="n">immeta</span><span class="p">):</span>

        <span class="n">meta</span><span class="o">.</span><span class="n">setNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformNoDataValue</span><span class="p">())</span></div>


<div class="viewcode-block" id="Estimator.transformInverseMeta"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.transformInverseMeta">[docs]</a>    <span class="k">def</span> <span class="nf">transformInverseMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">iimeta</span><span class="p">,</span> <span class="n">immeta</span><span class="p">):</span>

        <span class="n">meta</span><span class="o">.</span><span class="n">setNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformNoDataValue</span><span class="p">())</span></div>


<div class="viewcode-block" id="Estimator.name"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="Estimator.finalEstimator"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.finalEstimator">[docs]</a>    <span class="k">def</span> <span class="nf">finalEstimator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">_final_estimator</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">grid_search</span><span class="o">.</span><span class="n">GridSearchCV</span><span class="p">):</span>
            <span class="n">finalEstimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">_final_estimator</span><span class="o">.</span><span class="n">best_estimator_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">finalEstimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">_final_estimator</span>

        <span class="k">return</span> <span class="n">finalEstimator</span></div>


<div class="viewcode-block" id="Estimator.signature"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.signature">[docs]</a>    <span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="kn">import</span> <span class="nn">inspect</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">)</span>
        <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">sig</span><span class="o">.</span><span class="n">defaults</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">statement</span></div>


<div class="viewcode-block" id="Estimator.report"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">sklearnName</span><span class="p">(</span><span class="n">sklEstimator</span><span class="p">):</span>

            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">sklEstimator</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">sklearnURL</span><span class="p">(</span><span class="n">sklEstimator</span><span class="p">):</span>

            <span class="kn">import</span> <span class="nn">urllib2</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">longname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">sklearnName</span><span class="p">(</span><span class="n">sklEstimator</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://scikit-learn.org/stable/modules/generated/&#39;</span> <span class="o">+</span> <span class="n">longname</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
                <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">longname</span> <span class="o">=</span> <span class="n">sklEstimator</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">sklearnName</span><span class="p">(</span><span class="n">sklEstimator</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://scikit-learn.org/stable/modules/generated/&#39;</span> <span class="o">+</span> <span class="n">longname</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
            <span class="k">return</span> <span class="n">url</span>

        <span class="n">hyperlinks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">finalEstimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalEstimator</span><span class="p">()</span>
        <span class="n">finalEstimatorName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">finalEstimator</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;View &#39;</span> <span class="o">+</span> <span class="n">finalEstimatorName</span> <span class="o">+</span> <span class="s1">&#39; Model&#39;</span><span class="p">)</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Input Files&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;Image:  &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Labels: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Training Data&#39;</span><span class="p">))</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Number of Samples:  &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">labelData</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;Number of Features: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">imageData</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Classifier</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;Number of Classes:  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;Class Names:        &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;class names&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">appendReport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reportDetails</span><span class="p">())</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHorizontalLine</span><span class="p">())</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Advanced Information&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Final Model Parameter&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">finalEstimator</span><span class="p">)))</span>

        <span class="n">hyperlinks</span><span class="p">[</span><span class="n">sklearnName</span><span class="p">(</span><span class="n">finalEstimator</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sklearnURL</span><span class="p">(</span><span class="n">finalEstimator</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Pipeline Parameter&#39;</span><span class="p">))</span>
            <span class="n">hyperlinks</span><span class="p">[</span><span class="n">sklearnName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sklearnURL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">estimator</span><span class="p">),</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">steps</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>

                <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Step &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">estimator</span><span class="p">)))</span>

                <span class="n">hyperlinks</span><span class="p">[</span><span class="n">sklearnName</span><span class="p">(</span><span class="n">estimator</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sklearnURL</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">grid_search</span><span class="o">.</span><span class="n">GridSearchCV</span><span class="p">):</span>

                    <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Best Parameters&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">estimator</span><span class="o">.</span><span class="n">best_params_</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
                    <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

                    <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Best Score&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">estimator</span><span class="o">.</span><span class="n">best_params_</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
                    <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">estimator</span><span class="o">.</span><span class="n">scoring</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">estimator</span><span class="o">.</span><span class="n">best_score_</span><span class="o">*</span><span class="n">estimator</span><span class="o">.</span><span class="n">scorer_</span><span class="o">.</span><span class="n">_sign</span><span class="p">)))</span>

                    <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Search History&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">round</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">mean_validation_score</span><span class="o">*</span><span class="n">estimator</span><span class="o">.</span><span class="n">scorer_</span><span class="o">.</span><span class="n">_sign</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">estimator</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">]</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="n">estimator</span><span class="o">.</span><span class="n">scorer_</span><span class="o">.</span><span class="n">_sign</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">header_row</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">estimator</span><span class="o">.</span><span class="n">scoring</span><span class="p">)]</span><span class="o">+</span><span class="n">estimator</span><span class="o">.</span><span class="n">best_params_</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportTable</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHorizontalLine</span><span class="p">())</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Scikit-Learn Documentation&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">hyperlinks</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHyperlink</span><span class="p">(</span><span class="n">hyperlinks</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">key</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">report</span></div>


<div class="viewcode-block" id="Estimator.reportDetails"><a class="viewcode-back" href="../../eb.html#eb.types.Estimator.reportDetails">[docs]</a>    <span class="k">def</span> <span class="nf">reportDetails</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Classifier"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier">[docs]</a><span class="k">class</span> <span class="nc">Classifier</span><span class="p">(</span><span class="n">Estimator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">Estimator</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>


<div class="viewcode-block" id="Classifier.fit"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">Classification</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">ClassificationSample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span></div>


<div class="viewcode-block" id="Classifier.predict"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="s1">&#39;classification&#39;</span><span class="p">),</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">predictfile</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Classification</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="Classifier.predictDType"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.predictDType">[docs]</a>    <span class="k">def</span> <span class="nf">predictDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span></div>


<div class="viewcode-block" id="Classifier.predictNoDataValue"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.predictNoDataValue">[docs]</a>    <span class="k">def</span> <span class="nf">predictNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Classifier.predictProbabilityDType"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.predictProbabilityDType">[docs]</a>    <span class="k">def</span> <span class="nf">predictProbabilityDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span></div>


<div class="viewcode-block" id="Classifier.predictProbabilityNoDataValue"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.predictProbabilityNoDataValue">[docs]</a>    <span class="k">def</span> <span class="nf">predictProbabilityNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>


<div class="viewcode-block" id="Classifier.predictProbability"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.predictProbability">[docs]</a>    <span class="k">def</span> <span class="nf">predictProbability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">),</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">probafile</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Probability</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="Classifier.predictMeta"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.predictMeta">[docs]</a>    <span class="k">def</span> <span class="nf">predictMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">imeta</span><span class="p">,</span> <span class="n">mmeta</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">Meta</span><span class="p">)</span>
        <span class="n">Estimator</span><span class="o">.</span><span class="n">predictMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">imeta</span><span class="p">,</span> <span class="n">mmeta</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setMetadataItem</span><span class="p">(</span><span class="s1">&#39;file_type&#39;</span><span class="p">,</span> <span class="s1">&#39;envi classification&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;class_names&#39;</span><span class="p">,</span> <span class="s1">&#39;class_lookup&#39;</span><span class="p">,</span> <span class="s1">&#39;classes&#39;</span><span class="p">]:</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">copyMetadataItem</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span></div>


<div class="viewcode-block" id="Classifier.predictProbabilityMeta"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.predictProbabilityMeta">[docs]</a>    <span class="k">def</span> <span class="nf">predictProbabilityMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">imeta</span><span class="p">,</span> <span class="n">mmeta</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">Meta</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setNoDataValue</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setBandNames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;class names&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;class_names&#39;</span><span class="p">,</span> <span class="s1">&#39;class_lookup&#39;</span><span class="p">,</span> <span class="s1">&#39;classes&#39;</span><span class="p">]:</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">copyMetadataItem</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span></div>


<div class="viewcode-block" id="Classifier.UncertaintyClassifierFP"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.UncertaintyClassifierFP">[docs]</a>    <span class="k">def</span> <span class="nf">UncertaintyClassifierFP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">UncertaintyClassifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;fp&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Classifier.UncertaintyClassifierFN"><a class="viewcode-back" href="../../eb.html#eb.types.Classifier.UncertaintyClassifierFN">[docs]</a>    <span class="k">def</span> <span class="nf">UncertaintyClassifierFN</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">UncertaintyClassifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;fn&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="UncertaintyClassifier"><a class="viewcode-back" href="../../eb.html#eb.types.UncertaintyClassifier">[docs]</a><span class="k">class</span> <span class="nc">UncertaintyClassifier</span><span class="p">(</span><span class="n">Classifier</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classifier</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">Classifier</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">eb.estimators</span> <span class="kn">import</span> <span class="n">SklearnClassifiers</span>
        <span class="n">pipe</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">make_pipeline</span><span class="p">(</span><span class="n">SklearnClassifiers</span><span class="o">.</span><span class="n">UncertaintyClassifier</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">sklEstimator</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">))</span>
        <span class="n">Classifier</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe</span><span class="p">)</span></div>


<div class="viewcode-block" id="Regressor"><a class="viewcode-back" href="../../eb.html#eb.types.Regressor">[docs]</a><span class="k">class</span> <span class="nc">Regressor</span><span class="p">(</span><span class="n">Estimator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">Estimator</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>


<div class="viewcode-block" id="Regressor.fit"><a class="viewcode-back" href="../../eb.html#eb.types.Regressor.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">Regression</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">RegressionSample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span></div>


<div class="viewcode-block" id="Regressor.predict"><a class="viewcode-back" href="../../eb.html#eb.types.Regressor.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="s1">&#39;regression&#39;</span><span class="p">)):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">predictfile</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Regression</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="Regressor.predictDType"><a class="viewcode-back" href="../../eb.html#eb.types.Regressor.predictDType">[docs]</a>    <span class="k">def</span> <span class="nf">predictDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span></div>


<div class="viewcode-block" id="Regressor.predictNoDataValue"><a class="viewcode-back" href="../../eb.html#eb.types.Regressor.predictNoDataValue">[docs]</a>    <span class="k">def</span> <span class="nf">predictNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getNoDataValue</span><span class="p">()</span></div>


<div class="viewcode-block" id="Regressor.UncertaintyRegressor"><a class="viewcode-back" href="../../eb.html#eb.types.Regressor.UncertaintyRegressor">[docs]</a>    <span class="k">def</span> <span class="nf">UncertaintyRegressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">UncertaintyRegressor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="UncertaintyRegressor"><a class="viewcode-back" href="../../eb.html#eb.types.UncertaintyRegressor">[docs]</a><span class="k">class</span> <span class="nc">UncertaintyRegressor</span><span class="p">(</span><span class="n">Regressor</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regressor</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regressor</span><span class="p">,</span> <span class="n">Regressor</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">eb.estimators</span> <span class="kn">import</span> <span class="n">SklearnRegressors</span>
        <span class="n">pipe</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">make_pipeline</span><span class="p">(</span><span class="n">SklearnRegressors</span><span class="o">.</span><span class="n">UncertaintyRegressor</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">sklEstimator</span><span class="p">))</span>
        <span class="n">Regressor</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe</span><span class="p">)</span>


<div class="viewcode-block" id="UncertaintyRegressor.predictNoDataValue"><a class="viewcode-back" href="../../eb.html#eb.types.UncertaintyRegressor.predictNoDataValue">[docs]</a>    <span class="k">def</span> <span class="nf">predictNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="mi">0</span></div></div>


<div class="viewcode-block" id="Transformer"><a class="viewcode-back" href="../../eb.html#eb.types.Transformer">[docs]</a><span class="k">class</span> <span class="nc">Transformer</span><span class="p">(</span><span class="n">Estimator</span><span class="p">):</span>

<div class="viewcode-block" id="Transformer.fit"><a class="viewcode-back" href="../../eb.html#eb.types.Transformer.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">Mask</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">ImageSample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span></div>


<div class="viewcode-block" id="Transformer.transform"><a class="viewcode-back" href="../../eb.html#eb.types.Transformer.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="s1">&#39;transformation&#39;</span><span class="p">),</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">transformfile</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="Transformer.transformInverse"><a class="viewcode-back" href="../../eb.html#eb.types.Transformer.transformInverse">[docs]</a>    <span class="k">def</span> <span class="nf">transformInverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="s1">&#39;inverseTransformation&#39;</span><span class="p">),</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">inversetransformfile</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="Transformer.transformDType"><a class="viewcode-back" href="../../eb.html#eb.types.Transformer.transformDType">[docs]</a>    <span class="k">def</span> <span class="nf">transformDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span></div>


<div class="viewcode-block" id="Transformer.transformNoDataValue"><a class="viewcode-back" href="../../eb.html#eb.types.Transformer.transformNoDataValue">[docs]</a>    <span class="k">def</span> <span class="nf">transformNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformDType</span><span class="p">())</span><span class="o">.</span><span class="n">max</span></div></div>


<div class="viewcode-block" id="Clusterer"><a class="viewcode-back" href="../../eb.html#eb.types.Clusterer">[docs]</a><span class="k">class</span> <span class="nc">Clusterer</span><span class="p">(</span><span class="n">Estimator</span><span class="p">):</span>

<div class="viewcode-block" id="Clusterer.fit"><a class="viewcode-back" href="../../eb.html#eb.types.Clusterer.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">Mask</span><span class="p">)</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">ImageSample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span></div>


<div class="viewcode-block" id="Clusterer.predict"><a class="viewcode-back" href="../../eb.html#eb.types.Clusterer.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tempfile</span><span class="p">(</span><span class="s1">&#39;clustering&#39;</span><span class="p">)):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">predictfile</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Classification</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="Clusterer.predictMeta"><a class="viewcode-back" href="../../eb.html#eb.types.Clusterer.predictMeta">[docs]</a>    <span class="k">def</span> <span class="nf">predictMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">Meta</span><span class="p">)</span>
        <span class="n">n_clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklEstimator</span><span class="o">.</span><span class="n">_final_estimator</span><span class="o">.</span><span class="n">n_clusters</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setMetadataItem</span><span class="p">(</span><span class="s1">&#39;file_type&#39;</span><span class="p">,</span> <span class="s1">&#39;envi classification&#39;</span><span class="p">)</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setMetadataItem</span><span class="p">(</span><span class="s1">&#39;class_names&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Undefined&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Cluster &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_clusters</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setMetadataItem</span><span class="p">(</span><span class="s1">&#39;class_lookup&#39;</span><span class="p">,</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_clusters</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)))</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">setMetadataItem</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">,</span> <span class="n">n_clusters</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="Clusterer.predictDType"><a class="viewcode-back" href="../../eb.html#eb.types.Clusterer.predictDType">[docs]</a>    <span class="k">def</span> <span class="nf">predictDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span></div>


<div class="viewcode-block" id="Clusterer.predictNoDataValue"><a class="viewcode-back" href="../../eb.html#eb.types.Clusterer.predictNoDataValue">[docs]</a>    <span class="k">def</span> <span class="nf">predictNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="mi">0</span></div></div>


<div class="viewcode-block" id="ImageSample"><a class="viewcode-back" href="../../eb.html#eb.types.ImageSample">[docs]</a><span class="k">class</span> <span class="nc">ImageSample</span><span class="p">(</span><span class="n">Type</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readData</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)</span><span class="se">\n</span><span class="s1">  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="p">),</span> <span class="s1">&#39;Image must be an Image&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">Mask</span><span class="p">),</span> <span class="s1">&#39;Mask must be a Mask&#39;</span>
        <span class="c1"># assert image.pixelGrid.equalTo(mask.pixelGrid)</span>
        <span class="c1"># assert image.boundingBox.equalTo(mask.boundingBox)</span>

    <span class="k">def</span> <span class="nf">_readData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># use rios for reading the labeled data</span>

        <span class="n">infiles</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">FilenameAssociations</span><span class="p">()</span>
        <span class="n">outfiles</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">FilenameAssociations</span><span class="p">()</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="n">ApplierControls</span><span class="p">()</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">OtherInputs</span><span class="p">()</span>

        <span class="n">infiles</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">infiles</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">args</span><span class="o">.</span><span class="n">xMeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span>
        <span class="n">args</span><span class="o">.</span><span class="n">yMeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span>

        <span class="n">args</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">args</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">ufunc</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>

            <span class="n">ApplierHelper</span><span class="o">.</span><span class="n">reshape2d</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">ApplierHelper</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">yMeta</span><span class="o">.</span><span class="n">getNoDataValue</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ApplierHelper</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
            <span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ApplierHelper</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>


        <span class="n">rios</span><span class="o">.</span><span class="n">applier</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ufunc</span><span class="p">,</span> <span class="n">infiles</span><span class="p">,</span> <span class="n">outfiles</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="ClassificationSample"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationSample">[docs]</a><span class="k">class</span> <span class="nc">ClassificationSample</span><span class="p">(</span><span class="n">ImageSample</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ImageSample</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">Classification</span><span class="p">),</span> <span class="s1">&#39;Mask is not a Classification!&#39;</span></div>


<div class="viewcode-block" id="RegressionSample"><a class="viewcode-back" href="../../eb.html#eb.types.RegressionSample">[docs]</a><span class="k">class</span> <span class="nc">RegressionSample</span><span class="p">(</span><span class="n">ImageSample</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ImageSample</span><span class="o">.</span><span class="n">_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">Regression</span><span class="p">),</span> <span class="s1">&#39;Mask is not a Regression!&#39;</span></div>


<div class="viewcode-block" id="ClassificationPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformance">[docs]</a><span class="k">class</span> <span class="nc">ClassificationPerformance</span><span class="p">(</span><span class="n">Type</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ClassificationPerformance.fromSample"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformance.fromSample">[docs]</a>    <span class="k">def</span> <span class="nf">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">ClassificationSample</span><span class="p">),</span> <span class="s1">&#39;Classification sample is requiered!&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">Classification</span><span class="p">),</span> <span class="s1">&#39;Prediction is not a classification!&#39;</span>
        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">)),</span> <span class="s1">&#39;Number of classes in prediction and reference do not match!&#39;</span>
        <span class="n">mappedClassSizes</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">statistics</span><span class="p">()</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mappedClassProportions</span> <span class="o">=</span> <span class="n">mappedClassSizes</span><span class="o">/</span><span class="n">mappedClassSizes</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ClassificationPerformance</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                           <span class="n">classNames</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;class names&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:],</span>
                                           <span class="n">mappedClassProportions</span><span class="o">=</span><span class="n">mappedClassProportions</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">yPrediction</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">yTruth</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">labelData</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">assessPerformance</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_fix</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">a</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">a</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">a</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">classNames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mappedClassProportions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">classNames</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">classNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Class &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">classes</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="n">classes</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">classNames</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="n">classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classLabels</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classNames</span> <span class="o">=</span> <span class="n">classNames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mij</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">classes</span><span class="p">,</span> <span class="n">classes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wi</span> <span class="o">=</span> <span class="n">mappedClassProportions</span>


<div class="viewcode-block" id="ClassificationPerformance.update"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformance.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yPrediction</span><span class="p">,</span> <span class="n">yTruth</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yPrediction</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mij</span> <span class="o">+=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">yPrediction</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classLabels</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+=</span> <span class="n">yPrediction</span><span class="o">.</span><span class="n">size</span></div>


<div class="viewcode-block" id="ClassificationPerformance.assessPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformance.assessPerformance">[docs]</a>    <span class="k">def</span> <span class="nf">assessPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">old_error_state</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">geterr</span><span class="p">()</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">over</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="n">under</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>

        <span class="c1"># get some stats from the confusion matrix mij</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mi_</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># class-wise sum over all prediction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_j</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># class-wise sum over references</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mii</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">)</span> <span class="c1"># main diagonal -&gt; class-wise correctly classified samples</span>

        <span class="c1"># estimate mapped class proportions from the reference sample, if not provided by the user</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span>  <span class="c1"># note that in this case pij is reduced to pij=mij/m</span>

        <span class="c1"># pij is the proportion of area estimate</span>
        <span class="c1"># pij = Wi*mij/mi_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pij</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pi_</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_j</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pii</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">)</span>

        <span class="c1"># calculate performance measures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F1Accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracy</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracy</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConditionalKappaAccuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mii</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mi_</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mi_</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mi_</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OverallAccuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">KappaAccuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">)))</span>

        <span class="c1"># calculate squared standard errors (SSE)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OverallAccuracySSE</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">OverallAccuracySSE</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

        <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
                <span class="n">a4</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a4</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">-</span><span class="n">a3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a2</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">b3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">a4</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a2</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">KappaAccuracySSE</span> <span class="o">=</span> <span class="p">(</span><span class="n">b1</span><span class="o">+</span><span class="n">b2</span><span class="o">+</span><span class="n">b3</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracySSE</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span> <span class="k">continue</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracySSE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="nb">sum</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracySSE</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracySSE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span> <span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">F1AccuracySSE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracySSE</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracySSE</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracySSE</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracySSE</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ConditionalKappaAccuracySSE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mii</span><span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ClassProportion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ClassProportionSSE</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ClassProportionSSE</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


        <span class="n">numpy</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">old_error_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClassificationPerformance.confidenceIntervall"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformance.confidenceIntervall">[docs]</a>    <span class="k">def</span> <span class="nf">confidenceIntervall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sse</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>

        <span class="n">se</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">sse</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">se</span> <span class="o">+</span> <span class="n">mean</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">se</span> <span class="o">+</span> <span class="n">mean</span>
        <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span></div>

<div class="viewcode-block" id="ClassificationPerformance.report"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformance.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;Classification Performance&#39;</span><span class="p">)</span>


<span class="c1">#        report.append(ReportHeading(&#39;Input Files&#39;))</span>
<span class="c1">#        report.append(ReportMonospace(&#39;Reference   &#39; + self.sample.mask.filename + &#39;\nPrediction: &#39; + self.sample.image.filename))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Classification Label Overview&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="s1">&#39;Reference: &#39;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;class names&#39;</span><span class="p">))))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="s1">&#39;Prediction: &#39;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;class names&#39;</span><span class="p">))))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Confusion Matrix&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;mij = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;mi_ = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mi_</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;m_j = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_j</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;m = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Proportion Matrix&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;pij = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pij</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;pi_ = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi_</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;p_j = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_j</span><span class="p">)))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Accuracies&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;UserAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracy</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;ProducerAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracy</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;F1Accuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F1Accuracy</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;ConditionalKappaAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConditionalKappaAccuracy</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;OverallAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OverallAccuracy</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;KappaAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KappaAccuracy</span><span class="p">)))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Confidence Intervalls alpha=5%&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;UserAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidenceIntervall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UserAccuracySSE</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;ProducerAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidenceIntervall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProducerAccuracySSE</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;F1Accuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidenceIntervall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F1Accuracy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">F1AccuracySSE</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;ConditionalKappaAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidenceIntervall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConditionalKappaAccuracy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConditionalKappaAccuracySSE</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;OverallAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidenceIntervall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OverallAccuracy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OverallAccuracySSE</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;KappaAccuracy = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidenceIntervall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KappaAccuracy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">KappaAccuracySSE</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;ClassProportion = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidenceIntervall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ClassProportion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ClassProportionSSE</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))))</span>


        <span class="k">return</span> <span class="n">report</span></div></div>


<div class="viewcode-block" id="ClassificationPerformanceAdjusted"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformanceAdjusted">[docs]</a><span class="k">class</span> <span class="nc">ClassificationPerformanceAdjusted</span><span class="p">(</span><span class="n">ClassificationPerformance</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ClassificationPerformanceAdjusted.fromSample"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformanceAdjusted.fromSample">[docs]</a>    <span class="k">def</span> <span class="nf">fromSample</span><span class="p">(</span><span class="n">samplePrediction</span><span class="p">,</span> <span class="n">sampleStratification</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samplePrediction</span><span class="p">,</span> <span class="n">ClassificationSample</span><span class="p">),</span> <span class="s1">&#39;Classification sample is requiered!&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sampleStratification</span><span class="p">,</span> <span class="n">ClassificationSample</span><span class="p">),</span> <span class="s1">&#39;Classification sample is requiered!&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samplePrediction</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">Classification</span><span class="p">),</span> <span class="s1">&#39;Prediction is not a classification!&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sampleStratification</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">Classification</span><span class="p">),</span> <span class="s1">&#39;Stratification is not a classification!&#39;</span>

        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">samplePrediction</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">samplePrediction</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">getMetadataItem</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">)),</span> <span class="s1">&#39;Number of classes in prediction and reference do not match!&#39;</span>

        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="n">strataClasses</span> <span class="o">=</span> <span class="n">sampleStratification</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Classes</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">strataSizes</span> <span class="o">=</span> <span class="n">sampleStratification</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">statistics</span><span class="p">()</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">strataSampleSizes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">sampleStratification</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">strataClasses</span><span class="o">+</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">strataWeights</span> <span class="o">=</span> <span class="p">(</span><span class="n">strataSizes</span><span class="o">/</span><span class="n">strataSizes</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">strataSampleSizes</span><span class="o">/</span><span class="n">strataSampleSizes</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">ClassificationPerformanceAdjusted</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="n">samplePrediction</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Classes</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                   <span class="n">classNames</span><span class="o">=</span><span class="n">samplePrediction</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ClassNames</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                                   <span class="n">strataClasses</span><span class="o">=</span><span class="n">strataClasses</span><span class="p">,</span>
                                                   <span class="n">strataClassNames</span><span class="o">=</span><span class="n">sampleStratification</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ClassNames</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                                   <span class="n">strataWeights</span><span class="o">=</span><span class="n">strataWeights</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">samplePrediction</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sampleStratification</span> <span class="o">=</span> <span class="n">sampleStratification</span>
        <span class="n">result</span><span class="o">.</span><span class="n">strataSizes</span> <span class="o">=</span> <span class="n">strataSizes</span>
        <span class="n">result</span><span class="o">.</span><span class="n">strataSampleSizes</span> <span class="o">=</span> <span class="n">strataSampleSizes</span>

        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">yPrediction</span><span class="o">=</span><span class="n">samplePrediction</span><span class="o">.</span><span class="n">imageData</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yTruth</span><span class="o">=</span><span class="n">samplePrediction</span><span class="o">.</span><span class="n">labelData</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yS</span><span class="o">=</span><span class="n">sampleStratification</span><span class="o">.</span><span class="n">imageData</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">result</span><span class="o">.</span><span class="n">assessPerformance</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">strataClasses</span><span class="p">,</span> <span class="n">strataWeights</span><span class="p">,</span> <span class="n">classNames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">strataClassNames</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">strataClasses</span> <span class="o">=</span> <span class="n">strataClasses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strataClassNames</span> <span class="o">=</span> <span class="n">strataClassNames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classificationPerformances</span> <span class="o">=</span> <span class="p">[</span><span class="n">ClassificationPerformance</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">classNames</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strataClasses</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">ClassificationPerformance</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">classNames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mij</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strataWeights</span> <span class="o">=</span> <span class="n">strataWeights</span>


<div class="viewcode-block" id="ClassificationPerformanceAdjusted.update"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformanceAdjusted.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yPrediction</span><span class="p">,</span> <span class="n">yTruth</span><span class="p">,</span> <span class="n">yS</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yPrediction</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yS</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mij</span> <span class="o">*=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*=</span> <span class="mf">0.</span>
        <span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">stratum</span><span class="p">,</span> <span class="n">classificationPerformance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classificationPerformances</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">yS</span> <span class="o">==</span> <span class="n">stratum</span>
            <span class="n">classificationPerformance</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">yTruth</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">yPrediction</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mij</span> <span class="o">+=</span> <span class="n">classificationPerformance</span><span class="o">.</span><span class="n">mij</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">strataWeights</span><span class="p">[</span><span class="n">stratum</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classificationPerformance</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+=</span> <span class="n">classificationPerformance</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">strataWeights</span><span class="p">[</span><span class="n">stratum</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="ClassificationPerformanceAdjusted.report"><a class="viewcode-back" href="../../eb.html#eb.types.ClassificationPerformanceAdjusted.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">ClassificationPerformance</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Adjusted &#39;</span><span class="o">+</span><span class="n">report</span><span class="o">.</span><span class="n">title</span>

        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Stratification Overview&#39;</span><span class="p">))</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Strata names: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strataClassNames</span><span class="p">))))</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Strata weights: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strataWeights</span><span class="p">))))</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Strata sample sizes: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strataSampleSizes</span><span class="p">))))</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Strata sizes: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strataSizes</span><span class="p">))))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">+</span><span class="n">report</span><span class="o">.</span><span class="n">items</span>

        <span class="k">return</span> <span class="n">report</span></div></div>



<div class="viewcode-block" id="RegressionPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.RegressionPerformance">[docs]</a><span class="k">class</span> <span class="nc">RegressionPerformance</span><span class="p">(</span><span class="n">Type</span><span class="p">):</span>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="RegressionPerformance.fromSample"><a class="viewcode-back" href="../../eb.html#eb.types.RegressionPerformance.fromSample">[docs]</a>    <span class="k">def</span> <span class="nf">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">RegressionSample</span><span class="p">),</span> <span class="s1">&#39;Regression sample is requiered!&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">Regression</span><span class="p">),</span> <span class="s1">&#39;Prediction is not a regression!&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RegressionPerformance</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">yPrediction</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">yTruth</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">labelData</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">assessPerformance</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>


<div class="viewcode-block" id="RegressionPerformance.update"><a class="viewcode-back" href="../../eb.html#eb.types.RegressionPerformance.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yPrediction</span><span class="p">,</span> <span class="n">yTruth</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yPrediction</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">,</span> <span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">yTruth</span><span class="p">)</span></div>


<div class="viewcode-block" id="RegressionPerformance.assessPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.RegressionPerformance.assessPerformance">[docs]</a>    <span class="k">def</span> <span class="nf">assessPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ExplainedVarianceScore</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">explained_variance_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MeanAbsoluteError</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MedianAbsoluteError</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">median_absolute_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RootMeanSquaredError</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">))</span></div>


<div class="viewcode-block" id="RegressionPerformance.report"><a class="viewcode-back" href="../../eb.html#eb.types.RegressionPerformance.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;Regression Performance&#39;</span><span class="p">)</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Accuracies&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;ExplainedVarianceScore = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExplainedVarianceScore</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;MeanAbsoluteError = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;MedianAbsoluteError = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MedianAbsoluteError</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;RootMeanSquaredError = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RootMeanSquaredError</span><span class="p">)))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Scatter Plot&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;reference =  &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;prediction = &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))))</span>

        <span class="k">return</span> <span class="n">report</span></div></div>


<div class="viewcode-block" id="ClusteringPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.ClusteringPerformance">[docs]</a><span class="k">class</span> <span class="nc">ClusteringPerformance</span><span class="p">(</span><span class="n">Type</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ClusteringPerformance.fromSample"><a class="viewcode-back" href="../../eb.html#eb.types.ClusteringPerformance.fromSample">[docs]</a>    <span class="k">def</span> <span class="nf">fromSample</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">ClassificationSample</span><span class="p">),</span> <span class="s1">&#39;Classification sample is requiered!&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">Classification</span><span class="p">),</span> <span class="s1">&#39;Prediction is not a classification!&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ClusteringPerformance</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">yPrediction</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">imageData</span><span class="p">,</span> <span class="n">yTruth</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">labelData</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">assessPerformance</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>


<div class="viewcode-block" id="ClusteringPerformance.update"><a class="viewcode-back" href="../../eb.html#eb.types.ClusteringPerformance.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yPrediction</span><span class="p">,</span> <span class="n">yTruth</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yPrediction</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">,</span> <span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="n">yTruth</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClusteringPerformance.assessPerformance"><a class="viewcode-back" href="../../eb.html#eb.types.ClusteringPerformance.assessPerformance">[docs]</a>    <span class="k">def</span> <span class="nf">assessPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AdjustedRandScore</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">adjusted_rand_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AdjustedMutualInfoScore</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">adjusted_mutual_info_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NormalizedMutualInfoScore</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">normalized_mutual_info_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MutualInfoScore</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">mutual_info_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">CompletenessScore</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">completeness_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HomogeneityScore</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">homogeneity_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VMeasureScore</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">v_measure_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yTruth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPrediction</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClusteringPerformance.report"><a class="viewcode-back" href="../../eb.html#eb.types.ClusteringPerformance.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span><span class="s1">&#39;Clustering Performance&#39;</span><span class="p">)</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Adjusted Rand index&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;adjusted rand score = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AdjustedRandScore</span><span class="p">)))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Mutual Information based scores&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;mutual information score =            &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MutualInfoScore</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;adjusted mutual information score =   &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AdjustedMutualInfoScore</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;normalized mutual information score = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NormalizedMutualInfoScore</span><span class="p">)))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Homogeneity, completeness and V-measure&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;homogeneity score =  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HomogeneityScore</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;completeness score = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CompletenessScore</span><span class="p">)))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportMonospace</span><span class="p">(</span><span class="s1">&#39;V-measure score =    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VMeasureScore</span><span class="p">)))</span>

        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHorizontalLine</span><span class="p">())</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHeading</span><span class="p">(</span><span class="s1">&#39;Scikit-Learn Documentation&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHyperlink</span><span class="p">(</span><span class="s1">r&#39;http://scikit-learn.org/stable/modules/clustering.html#adjusted-rand-index&#39;</span><span class="p">,</span> <span class="s1">&#39;Adjusted Rand index&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHyperlink</span><span class="p">(</span><span class="s1">r&#39;http://scikit-learn.org/stable/modules/clustering.html#mutual-information-based-scores&#39;</span><span class="p">,</span> <span class="s1">&#39;Mutual Information based scores&#39;</span><span class="p">))</span>
        <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReportHyperlink</span><span class="p">(</span><span class="s1">r&#39;http://scikit-learn.org/stable/modules/clustering.html#homogeneity-completeness-and-v-measure&#39;</span><span class="p">,</span> <span class="s1">&#39;Homogeneity, completeness and V-measure&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">report</span></div>


    <span class="k">def</span> <span class="nf">_assessPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">imageData</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">labelData</span></div>


</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Authors et al..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>